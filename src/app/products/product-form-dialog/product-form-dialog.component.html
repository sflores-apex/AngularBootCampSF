<h2 mat-dialog-title>{{label.dialogTitle}}</h2>

<mat-dialog-content class="pt-2">

  <form class="d-flex flex-column smaller-form" [formGroup]="productForm" (ngSubmit)="saveProduct()">
    <!--------------TITLE---------------->
    <app-form-input [label]="label.productTitle" [formGrp]="productForm" formCtrlName="title" />

    <div class="d-flex">
      <!--------------PRICES---------------->
      <fieldset class="fieldset me-2" formArrayName="prices">
        <div class="d-flex justify-content-between align-items-center">
          <legend>{{label.prices}}</legend>
          <button type="button" mat-icon-button color="accent" class="ms-2" (click)="addPrice()">
            <mat-icon>add</mat-icon>
          </button>
        </div>

        <mat-error>
          @if (productForm.controls.prices.hasError('unique')) {
          Price tag {{ messages.uniqueField }}
          }
        </mat-error>

        @for (pricesCtrl of productForm.controls.prices.controls; track pricesCtrl) {
        <div class="d-flex">
          <fieldset class="fieldset prices" [formGroupName]="$index">
            <legend>{{ label.price }} {{ $index + 1 }}</legend>

            <app-form-input [label]="label.priceTag" [formGrp]="pricesCtrl" formCtrlName="tag" />
            <app-form-input [label]="label.price" [formGrp]="pricesCtrl" formCtrlName="price" inputType="number" />
          </fieldset>

          @if (productForm.controls.prices.length > 1) {
          <button type="button" mat-icon-button color="accent" class="ms-2" (click)="removePrice($index)">
            <mat-icon>delete</mat-icon>
          </button>
          }
        </div>
        }
      </fieldset>

      <!--------------PHOTOS---------------->
      <fieldset class="fieldset" formArrayName="photos">
        <div class="d-flex justify-content-between align-items-center">
          <legend>{{label.photos}}</legend>
          <button type="button" mat-icon-button color="accent" class="ms-2" (click)="addPhoto()">
            <mat-icon>add</mat-icon>
          </button>
        </div>

        <mat-error>
          @if (productForm.controls.photos.hasError('unique')) {
          Photo url {{ messages.uniqueField }}
          }
        </mat-error>

        @for (photosCtrl of productForm.controls.photos.controls; track photosCtrl) {
        <div class="d-flex">
          <app-form-input [label]="label.urlPhoto" [formGrp]="photosCtrl" formCtrlName="urlPhoto" />

          @if (productForm.controls.photos.length > 1) {
          <button type="button" mat-icon-button color="accent" class="ms-2" (click)="removePhoto($index)">
            <mat-icon>delete</mat-icon>
          </button>
          }
        </div>
        }
      </fieldset>
    </div>

    <!--------------DESCRIPTION---------------->
    <app-form-input [label]="label.productDescription" [formGrp]="productForm" formCtrlName="description" />
    <!--------------OFFER DISCOUNT---------------->
    <app-form-input [label]="label.productOfferDiscount" [formGrp]="productForm" formCtrlName="offerDiscount" />

  </form>
</mat-dialog-content>

<mat-dialog-actions [align]="'end'">
  <button mat-button mat-dialog-close>{{label.cancelForm}}</button>
  <button mat-button (click)="saveProduct()" cdkFocusInitial>{{label.saveForm}}</button>
</mat-dialog-actions>
